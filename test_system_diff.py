#!/usr/bin/env python3
"""
ì‹œìŠ¤í…œì˜ ì¤„ ë‹¨ìœ„ diff í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
"""

from src.parallel.feedback.diff_util import extract_changes, compare_report_changes
import json

def test_system_diff():
    """ì‹œìŠ¤í…œì˜ ì¤„ ë‹¨ìœ„ diff í•¨ìˆ˜ ì§ì ‘ í…ŒìŠ¤íŠ¸"""
    
    print("ğŸ” ì‹œìŠ¤í…œ ì¤„ ë‹¨ìœ„ DIFF í…ŒìŠ¤íŠ¸")
    print("="*80)
    
    # ë³µì¡í•œ ë¦¬í¬íŠ¸ ì˜ˆì‹œ
    original = """# 2024ë…„ 3ë¶„ê¸° í”„ë¡œì íŠ¸ í˜„í™© ë³´ê³ ì„œ

## 1. ì „ì²´ ê°œìš”
ì´ë²ˆ ë¶„ê¸° ì£¼ìš” ì„±ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
- ë°±ì—”ë“œ API ê°œë°œ ì™„ë£Œ (80%)
- í”„ë¡ íŠ¸ì—”ë“œ UI êµ¬í˜„ (60%)
- ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ ì™„ë£Œ (90%)

## 2. ì£¼ìš” ì´ìŠˆ
í˜„ì¬ ë°œìƒí•œ ë¬¸ì œì ë“¤:
1. ì„œë²„ ì‘ë‹µì†ë„ ì§€ì—° (í‰ê·  2.5ì´ˆ)
2. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€
3. ë³´ì•ˆ ê²€í†  í•„ìš”

## 3. í–¥í›„ ì¼ì •
- 10ì›”: ì„±ëŠ¥ ìµœì í™”
- 11ì›”: ë² íƒ€ í…ŒìŠ¤íŠ¸
- 12ì›”: ì •ì‹ ëŸ°ì¹­"""

    modified = """# 2024ë…„ 3ë¶„ê¸° í”„ë¡œì íŠ¸ í˜„í™© ë³´ê³ ì„œ

## 1. ì „ì²´ ê°œìš”
ì´ë²ˆ ë¶„ê¸° ì£¼ìš” ì„±ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
- ë°±ì—”ë“œ API ê°œë°œ ì™„ë£Œ (95%) â† ëª©í‘œ ì´ˆê³¼ë‹¬ì„±
- í”„ë¡ íŠ¸ì—”ë“œ UI êµ¬í˜„ (85%) â† ë¹ ë¥¸ ì§„í–‰
- ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ ì™„ë£Œ (90%)
- ëª¨ë°”ì¼ ì•± ê°œë°œ ì‹œì‘ (20%) â† ì‹ ê·œ ì¶”ê°€

## 2. ì£¼ìš” ì´ìŠˆ
í˜„ì¬ ë°œìƒí•œ ë¬¸ì œì ë“¤:
1. ì„œë²„ ì‘ë‹µì†ë„ ê°œì„ ë¨ (í‰ê·  1.2ì´ˆ) â† ì„±ëŠ¥ í–¥ìƒ
2. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì í™” ì™„ë£Œ
3. ë³´ì•ˆ ê²€í†  ì™„ë£Œ â† í•´ê²°
4. SSL ì¸ì¦ì„œ ê°±ì‹  í•„ìš” â† ìƒˆë¡œìš´ ì´ìŠˆ

## 2.5 ì‹ ê·œ ê°œë°œ í•­ëª©
- React Native ê¸°ë°˜ ëª¨ë°”ì¼ ì•±
- ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ
- ì‚¬ìš©ì ê¶Œí•œ ê´€ë¦¬ ì‹œìŠ¤í…œ

## 3. í–¥í›„ ì¼ì •
- 10ì›”: ì„±ëŠ¥ ìµœì í™” ë° ëª¨ë°”ì¼ ì•± ê°œë°œ
- 11ì›”: ë² íƒ€ í…ŒìŠ¤íŠ¸ ë° ë³´ì•ˆ ê°•í™”
- 12ì›”: ì •ì‹ ëŸ°ì¹­"""

    print("ğŸ“„ ì›ë³¸ ë‚´ìš©:")
    print(original[:200] + "..." if len(original) > 200 else original)
    
    print("\nğŸ“ ìˆ˜ì •ëœ ë‚´ìš©:")
    print(modified[:200] + "..." if len(modified) > 200 else modified)
    
    print("\nğŸ” ì‹œìŠ¤í…œ diff ë¶„ì„:")
    print("-" * 50)
    
    # ì‹œìŠ¤í…œì˜ extract_changes í•¨ìˆ˜ ì§ì ‘ í˜¸ì¶œ
    result = extract_changes(original, modified)
    
    print(f"\nğŸ“Š ê²°ê³¼ ìš”ì•½:")
    print(f"ì¶”ê°€ëœ ì¤„: {len(result['insertions'])}ê°œ")
    print(f"ì‚­ì œëœ ì¤„: {len(result['deletions'])}ê°œ")
    print(f"ë³€ê²½ì‚¬í•­ ìˆìŒ: {result['has_changes']}")

def test_json_comparison():
    """JSON í˜•íƒœì˜ ë¦¬í¬íŠ¸ ë¹„êµ í…ŒìŠ¤íŠ¸"""
    
    print(f"\n{'='*80}")
    print("ğŸ” JSON ë¦¬í¬íŠ¸ ë¹„êµ í…ŒìŠ¤íŠ¸ (ì‹¤ì œ ì‹œìŠ¤í…œ ë°©ì‹)")
    print("="*80)
    
    # Draft JSON (ì›ë³¸)
    draft_json = {
        "reports": {
            "project_summary": """# í”„ë¡œì íŠ¸ ìš”ì•½
- API ê°œë°œ: 80% ì™„ë£Œ
- UI êµ¬í˜„: 60% ì§„í–‰ ì¤‘
- í…ŒìŠ¤íŠ¸: ë¯¸ì‹œì‘""",
            "issue_report": """## ì£¼ìš” ì´ìŠˆ
1. ì„±ëŠ¥ ë¬¸ì œ ìˆìŒ
2. ë³´ì•ˆ ê²€í†  í•„ìš”"""
        }
    }
    
    # Output JSON (ìˆ˜ì •ë³¸)
    output_json = {
        "final_reports": {
            "project_summary": """# í”„ë¡œì íŠ¸ ìš”ì•½
- API ê°œë°œ: 95% ì™„ë£Œ â† ëª©í‘œ ì´ˆê³¼
- UI êµ¬í˜„: 85% ì§„í–‰ ì¤‘ â† ë¹ ë¥¸ ì§„í–‰
- í…ŒìŠ¤íŠ¸: 30% ì‹œì‘ â† ì‹ ê·œ ì¶”ê°€
- ë°°í¬ ì¤€ë¹„: 10% â† ì¶”ê°€ í•­ëª©""",
            "issue_report": """## ì£¼ìš” ì´ìŠˆ
1. ì„±ëŠ¥ ë¬¸ì œ í•´ê²°ë¨ â† ê°œì„ 
2. ë³´ì•ˆ ê²€í†  ì™„ë£Œ â† í•´ê²°
3. SSL ì¸ì¦ì„œ ê°±ì‹  í•„ìš” â† ìƒˆ ì´ìŠˆ"""
        }
    }
    
    print("ğŸ“‹ Draft ë‚´ìš©:")
    for key, content in draft_json["reports"].items():
        print(f"  [{key}]: {content[:50]}...")
    
    print("\nğŸ“‹ Output ë‚´ìš©:")
    for key, content in output_json["final_reports"].items():
        print(f"  [{key}]: {content[:50]}...")
    
    print("\nğŸ” ì‹œìŠ¤í…œ JSON ë¹„êµ:")
    print("-" * 50)
    
    # ì‹œìŠ¤í…œì˜ compare_report_changes í•¨ìˆ˜ ì§ì ‘ í˜¸ì¶œ
    result = compare_report_changes(
        json.dumps(draft_json), 
        json.dumps(output_json)
    )
    
    print(f"\nğŸ“Š ë¹„êµ ê²°ê³¼:")
    print(f"ë¹„êµëœ í•­ëª©: {len(result['comparisons'])}ê°œ")
    print(f"ë³€ê²½ì‚¬í•­ ìˆìŒ: {bool(result['unified_diff'])}")

if __name__ == "__main__":
    test_system_diff()
    test_json_comparison() 